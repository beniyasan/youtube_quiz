# クイズゲームプレイシステム 要件仕様書

## 1. 概要
YouTubeプレイリストの動画を使用した早押しクイズシステムを実装する。
動画タイトルから正解キーワードを抽出し、段階的なヒント提示と早押し機能を提供する。

## 2. 機能要件

### 2.1 クイズ問題生成機能
- **入力**: 登録済みのYouTubeプレイリスト
- **処理**: 動画タイトルから正解キーワードを抽出
- **例**: "2025年 宝塚記念（GⅠ） | メイショウタバル | JRA公式" → 正解: "2025年宝塚記念" または "メイショウタバル"
- **ルール**: 
  - 年号＋レース名の組み合わせ
  - 競走馬名
  - その他動画タイトルの主要キーワード

### 2.2 段階的ヒント提示機能
クイズは以下の3段階で進行する：

#### 段階1: 音声のみ（15秒）
- 動画のランダムな区間の音声のみを再生
- 映像は表示しない
- 15秒経過で自動的に次の段階へ

#### 段階2: 映像付き（15秒）
- 動画のランダムな区間の映像と音声を再生
- 15秒経過で自動的に次の段階へ

#### 段階3: 最初から再生
- 動画を最初から再生
- 正解が出るまで継続

### 2.3 早押し機能
- **回答ボタン**: 各参加者が回答権を得るためのボタン
- **一時停止**: 誰かが回答ボタンを押した時点で音声/動画を一時停止
- **回答権**: 最初にボタンを押した参加者が回答権を獲得
- **回答時間制限**: 回答権獲得後、一定時間内（例：10秒）に回答する必要がある

### 2.4 正誤判定機能
- **正解**: 事前に設定された正解キーワードと回答を照合
- **部分一致**: 正解キーワードの一部が含まれていれば正解とする
- **曖昧マッチング**: ひらがな/カタカナ、漢字の変換、スペースの有無を考慮

### 2.5 ゲーム進行管理機能
- **正解時**: 次の問題に進む
- **不正解時**: お手付きとして該当参加者の回答権を剥奪、ゲーム続行
- **全員お手付き**: 自動的に次の段階に進む、または正解を表示

### 2.6 スコア管理機能
- **得点**: 正解した段階に応じて得点を付与
  - 段階1正解: 3点
  - 段階2正解: 2点
  - 段階3正解: 1点
- **お手付きペナルティ**: 不正解時に-1点

## 3. 非機能要件

### 3.1 リアルタイム通信
- WebSocketを使用した即座の早押し反映
- 複数参加者の同期した体験

### 3.2 YouTube API制限対応
- 埋め込み再生の制限に対する代替手段
- API使用量の最適化

### 3.3 レスポンス性能
- 回答ボタン押下から一時停止まで1秒以内
- 動画読み込み時間の最小化

### 3.4 ブラウザ対応
- Chrome, Firefox, Safari, Edge対応
- モバイルブラウザ対応

## 4. 技術制約

### 4.1 YouTube動画制限
- 著作権により埋め込み再生が制限される動画の処理
- プライベート動画や削除された動画の処理

### 4.2 音声のみ再生
- YouTube IFrame Player APIの制限により、音声のみ再生の代替実装が必要

## 5. ユーザーインターフェース要件

### 5.1 クイズ画面
- 動画プレイヤー（中央）
- 現在の段階表示
- 回答ボタン（各参加者用）
- スコアボード
- 残り時間表示

### 5.2 参加者管理
- 参加者名入力
- 参加者一覧表示
- 接続状態表示

## 6. データ要件

### 6.1 クイズセッション
- セッションID
- プレイリストID
- 参加者リスト
- 現在の問題番号
- 各参加者のスコア

### 6.2 問題データ
- YouTube動画ID
- 正解キーワード一覧
- 使用するランダム区間（開始時間）